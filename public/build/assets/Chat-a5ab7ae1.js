import{r as c,W as B,e as p,a as r,F as k,j as e,b as D,c as j,g as Y}from"./app-7acf19d0.js";import{U as H,e as T,w as O,C as q,L as A,M as F,D as U,f as W}from"./Dashboard-7c449020.js";import{S as G}from"./search-8c27863c.js";import{B as J}from"./Breadcrumb-9e4ecf35.js";import{E as K}from"./EditIcon-3ba22748.js";import{I as L}from"./index.es-e79c99ff.js";import{C as P}from"./CheckOutline-85554854.js";import{d as Q}from"./debounce-367be966.js";import{f as R}from"./index-3f3950c2.js";import"./index-4c8a935a.js";const V=h=>{const{auth:_,chat:f,chat_bot:l}=h,[m,d]=c.useState(!0),[N,x]=c.useState([]),[M,b]=c.useState(null),[I,u]=c.useState(!1),{data:y,setData:v,reset:w,post:E}=B({message:"",bot_id:l.id,chat_id:f.id,prompt:l.prompt}),C=async s=>{if(s.preventDefault(),u(!0),y.message.length>0){const o={role:"user",message:y.message};x(S=>[...S,o]),w("message");const n=await p.post("/ai-chats",y);n.data.error?(T(n.data.error),u(!1)):n.data.warning?(O(n.data.warning),u(!1)):(x(S=>[...S,n.data]),u(!1))}};c.useEffect(()=>{(async()=>{const s=await p.get(`/ai-chats/bot/messages/${l.id}/${f.id}`);x(o=>[...o,...s.data.data]),b(s.data),s.data.current_page>=s.data.last_page?d(!1):d(!0)})()},[]);const $=async s=>{const o=await p.get(s.next_page_url);x(n=>[...o.data.data,...n]),b(o.data),o.data.current_page>=o.data.last_page?d(!1):d(!0)};return r(k,{children:[e("div",{id:"scrollableDiv",className:"flex flex-col-reverse overflow-auto h-[calc(100vh-420px)] md:h-[calc(100vh-454px)]",children:e(L,{inverse:!0,hasMore:m,dataLength:N.length,next:()=>$(M),scrollableTarget:"scrollableDiv",style:{display:"flex",flexDirection:"column-reverse"},loader:e("p",{className:"text-center",children:"Loading..."}),endMessage:e("p",{className:"text-center",children:"Yay! You have seen it all"}),children:r("div",{className:"px-7 py-3.5 flex flex-col",children:[N.length>0&&N.map(s=>s.role==="user"?e("dib",{className:"w-full py-3.5 ",children:r("div",{className:"max-w-[80%] flex float-right",children:[e("p",{className:"p-5 text-sm bg-primary-25 text-gray-700 rounded-lg",children:s.message}),_.user.image?e("img",{src:`/${_.user.image}`,alt:"ai-bot",className:"w-9 h-9 ml-5 border border-white rounded-lg shadow-card"}):e(H,{className:"h-10 w-10 text-blue-gray-500 lg:m-1 cursor-pointer"})]})},s.id):r("div",{className:"py-3.5 max-w-[80%] flex",children:[e("img",{src:`/${l.image}`,alt:"ai-bot",className:"w-9 h-9 mr-5 border border-white rounded-lg shadow-card"}),e("div",{className:"w-full flex flex-col",children:e("pre",{className:"p-5 text-sm bg-primary-25 text-gray-700 rounded-lg whitespace-pre-wrap",children:s.message})})]},s.id)),I&&r("div",{className:"py-3.5 max-w-[80%] flex",children:[e("img",{src:`/${l.image}`,alt:"ai-bot",className:"w-9 h-9 mr-5 border border-white rounded-lg shadow-card"}),e("p",{className:"p-5 text-sm bg-primary-25 text-gray-700 rounded-lg",children:"Typing..."})]})]})})}),r("form",{onSubmit:C,className:"p-7 border-t border-gray-100 flex items-center",children:[e("input",{type:"text",value:y.message,onChange:s=>v("message",s.target.value),placeholder:"Enter a message here To send, press (shift + enter).",className:"w-full h-[38px] placeholder:text-gray-400 text-sm outline-0 pr-2"}),e(D.Button,{type:"submit",color:"white",className:"capitalize bg-primary-500 text-white text-sm !rounded px-7 py-2.5",children:"Send"})]})]})},X=h=>{const{auth:_,active:f,chat_bot:l}=h,[m,d]=c.useState(h.chats.data),[N,x]=c.useState(h.chats),[M,b]=c.useState(null),[I,u]=c.useState(!1),[y,v]=c.useState(!0),[w,E]=c.useState({id:"",value:""}),[C,$]=c.useState(null),s=async()=>{const a={chat_bot_id:l.id,title:"New Conversation"},t=await p.post("/ai-chats/chat/create",a);d(i=>[t.data,...i]),b(t.data)};c.useEffect(()=>{if(f){const a=parseInt(f),t=m.find(i=>i.id===a);b(t)}else b(m[1])},[]);const o=async a=>{const{current_page:t,last_page:i}=a;if(t<i){const g=await p.get(`/ai-chats/chats?page=${t+1}&bot_id=${l.id}`);d(z=>[...z,...g.data.data]),x(g.data),g.data.current_page>=g.data.last_page?v(!1):v(!0)}else v(!1)},n=async a=>{if(a.preventDefault(),$(!1),w.value.length>0)try{const t=await p.put(`/ai-chats/chat/update/${w.id}`,w);if(t.data.success){const i=m.map(g=>t.data.result.id===g.id?t.data.result:g);d(i)}else t.data.error&&T(t.data.error)}catch(t){W(t.response.data.errors.value)}},S=Q(async a=>{const t=a.target.value,i=await p.get(`/ai-chats/chat/search?value=${t}`);d(i.data),i.data.length<=0&&v(!1)},300);return r(k,{children:[e(j,{title:"Dashboard"}),e(J,{Icon:q,title:l.name}),r(D.Card,{className:"shadow-card h-[calc(100vh-232px)] md:h-[calc(100vh-266px)] overflow-hidden flex-row justify-end relative",children:[e("div",{className:`absolute top-0 left-0 z-10 h-full w-0 lg:w-[246px] bg-white  border-r border-gray-100 overflow-hidden transition-all duration-300 ${I?"w-[246px] shadow-card":"w-0"}`,children:r("div",{className:"w-[246px]",children:[r("div",{className:"w-full p-7 relative border-b border-gray-100 flex items-center",children:[r("div",{className:"w-full md:max-w-[260px] relative",children:[e("input",{type:"text",placeholder:"Search",onChange:S,className:"h-9 pr-12 pl-4 py-[15px] placeholder:text-gray-400 border border-gray-100 focus:border-primary-500 focus:ring-0 focus:outline-0 rounded-md w-full text-sm font-normal text-gray-500 bg-gray-100"}),e(G,{className:"absolute w-4 h-4 top-2.5 right-3 text-gray-400 z-10"})]}),e("button",{className:"block lg:hidden absolute top-7 right-0 bg-gray-200 hover:bg-gray-200 active:bg-gray-200 w-5 h-9 text-gray-500 rounded-l-md",onClick:()=>u(!1),children:e(A,{})})]}),e("div",{id:"scrollableDiv",className:"flex flex-col h-[calc(100vh-420px)] md:h-[calc(100vh-454px)] overflow-auto",children:e(L,{inverse:!1,hasMore:y,dataLength:m.length,scrollableTarget:"scrollableDiv",next:()=>o(N),style:{display:"flex",flexDirection:"column"},loader:e("p",{className:"text-center",children:"Loading..."}),endMessage:e("p",{className:"text-center my-2",children:"Yay! You have seen it all"}),children:m.map(a=>r("div",{className:`relative p-5 ${f==a.id?"bg-gray-100 hover:bg-gray-200":"bg-gray-25 hover:bg-gray-100"}`,children:[r("div",{className:"cursor-pointer w-full",onClick:()=>C!==a.id&&Y.get(`/ai-chats/bot/${l.id}?chat=${a.id}`),children:[C===a.id?r("form",{onSubmit:n,className:"relative rounded-md",children:[e("input",{required:!0,type:"text",placeholder:"Edit title",value:w.value,onChange:t=>E({id:a.id,value:t.target.value}),className:"h-8 pl-2.5 pr-12 py-[12px] placeholder:text-gray-400 outline outline-1 outline-gray-200 focus:outline-primary-500 focus:ring-0 rounded-md w-full text-sm font-normal text-gray-700",maxLength:20}),e("button",{type:"submit",className:"absolute top-0 right-0 w-8 h-full flex items-center justify-center bg-gray-200 rounded-r-md",children:e(P,{className:" text-gray-400 z-10"})})]}):e("p",{className:"text-sm text-gray-700 font-medium",children:a.title}),e("p",{className:"text-sm text-gray-400",children:R(new Date(a.created_at),"dd-MM-yyyy ss:mm:hh a")})]}),e("div",{className:"absolute top-4 right-4 z-10 w-4 h-4 cursor-pointer",children:C!==a.id&&e(K,{onClick:()=>{E({id:a.id,value:a.title}),$(a.id)},className:"w-4 h-4 text-gray-400"})})]},a.id))})}),e("div",{className:"p-7",children:e(D.Button,{color:"white",onClick:s,className:"w-full capitalize bg-primary-500 text-white text-sm !rounded px-7 py-2.5",children:"New Conversation"})})]})}),r("div",{className:"w-full lg:w-[calc(100%-246px)]",children:[r("div",{className:"p-7 border-b border-gray-100 flex items-center",children:[e(D.IconButton,{variant:"text",color:"blue-gray",className:"block lg:hidden mr-4",onClick:()=>u(!0),children:e(F,{})}),e("img",{src:`/${l.image}`,alt:"ai-bot",className:"w-9 h-9 border border-white rounded-lg shadow-card"}),e("p",{className:"text-lg text-gray-900 font-bold ml-3",children:l.name})]}),M&&l&&e(V,{auth:_,chat:M,chat_bot:l})]})]})]})};X.layout=h=>e(U,{children:h});export{X as default};
